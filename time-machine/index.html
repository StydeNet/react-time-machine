<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Time Machine with React</title>
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/favicon" />
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/favicon/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="./assets/favicon/favicon-16x16.png" />
    <link rel="manifest" href="./assets/favicon/site.webmanifest" />
    <link rel="mask-icon" href="./assets/favicon/safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="msapplication-TileColor" content="#ffc40d" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" href="./assets/time-machine.css" />
  </head>
  <body>
    <div id="app"></div>
    <script src="https://unpkg.com/@babel/standalone@7.12.4/babel.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.6/prop-types.js"></script>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script type="text/babel">
      const rootNode = document.getElementById("app");

      const MONTHS = ["jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"];

      const Title = ({ value, children, onClick }) => (
        <div>
          <h1 onClick={onClick} className="dt-title">
            {value}
          </h1>
          {children}
        </div>
      );

      Title.propTypes = {
        value: PropTypes.string.isRequired,
        children: PropTypes.node,
        onClick: PropTypes.func,
      };

      const Item = ({ title, value }) => (
        <li>
          <h3 className="dt-subtitle">{title}</h3>
          <p className="dt-value">{value}</p>
        </li>
      );

      Item.propTypes = {
        title: PropTypes.oneOf(["Month", "Day", "Year", "Hour", "Min"]).isRequired,
        value: PropTypes.string,
      };

      const List = ({ month, day, year, hour, min }) => (
        <ul>
          <Item title="Month" value={month} />
          <Item title="Day" value={day} />
          <Item title="Year" value={year} />
          <Item title="Hour" value={hour} />
          <Item title="Min" value={min} />
        </ul>
      );

      List.propTypes = {
        month: PropTypes.string.isRequired,
        day: PropTypes.string.isRequired,
        year: PropTypes.string.isRequired,
        hour: PropTypes.string.isRequired,
        min: PropTypes.string.isRequired,
      };

      const getValues = (time) => {
        const month = time ? MONTHS[new Date(time).getMonth().toString()] : "---";
        const day = time ? new Date(time).getDate().toString() : "--";
        const year = time ? new Date(time).getFullYear().toString() : "----";
        const hour = time ? new Date(time).getHours().toString() : "--";
        const min = time ? new Date(time).getMinutes().toString() : "--";
        return { month, day, year, hour, min };
      };

      const DestinationTime = ({ time, isOpen, setDtIsOpen, confirmDT }) => {
        const { month, day, year, hour, min } = getValues(time);
        return (
          <div className="dt destination">
            <List month={month} day={day} year={year} hour={hour} min={min} />
            <Title onClick={setDtIsOpen} value="Destination Time">
              {isOpen && <button onClick={confirmDT}>Confirm</button>}
            </Title>
          </div>
        );
      };

      DestinationTime.propTypes = {
        time: PropTypes.instanceOf(Date),
        isOpen: PropTypes.bool,
        setDtIsOpen: PropTypes.func.isRequired,
        confirmDT: PropTypes.func.isRequired,
      };

      const SetDestinationTime = ({ isOpen, setDateTime }) => {
        if (!isOpen) return null;
        return (
          <div className="dt set-destination-time">
            <ul>
              <li>
                <button onClick={() => setDateTime("INCREMENT", "month")}>+</button>
                <button onClick={() => setDateTime("DECREMENT", "month")}>-</button>
              </li>
              <li>
                <button onClick={() => setDateTime("INCREMENT", "day")}>+</button>
                <button onClick={() => setDateTime("DECREMENT", "day")}>-</button>
              </li>
              <li>
                <button onClick={() => setDateTime("INCREMENT", "year")}>+</button>
                <button onClick={() => setDateTime("DECREMENT", "year")}>-</button>
              </li>
              <li>
                <button onClick={() => setDateTime("INCREMENT", "hour")}>+</button>
                <button onClick={() => setDateTime("DECREMENT", "hour")}>-</button>
              </li>
              <li>
                <button onClick={() => setDateTime("INCREMENT", "min")}>+</button>
                <button onClick={() => setDateTime("DECREMENT", "min")}>-</button>
              </li>
            </ul>
            <Title value="Set Destination Time" />
          </div>
        );
      };

      SetDestinationTime.propTypes = {
        isOpen: PropTypes.bool,
        setDateTime: PropTypes.func.isRequired,
      };

      const PresentTime = ({ time }) => (
        <div className="dt present-time">
          <List
            month={MONTHS[time.getMonth()]}
            day={time.getDate().toString()}
            year={time.getFullYear().toString()}
            hour={time.getHours().toString()}
            min={time.getMinutes().toString()}
          />
          <Title value="Present Time" />
        </div>
      );

      PresentTime.propTypes = {
        time: PropTypes.instanceOf(Date),
      };

      const LastTime = ({ time }) => {
        const { month, day, year, hour, min } = getValues(time);
        return (
          <div className="dt last-time">
            <List month={month} day={day} year={year} hour={hour} min={min} />
            <Title value="Last Time Departed" />
          </div>
        );
      };

      LastTime.propTypes = {
        time: PropTypes.instanceOf(Date),
      };

      const TimesDepartedList = ({ times }) => {
        if (times.length < 1) return null;
        return (
          <div className="dt times-departed-list">
            <ul>
              {times.map((time) => (
                <li key={time}>{new Date(time).toString()}</li>
              ))}
            </ul>
            <Title value="Times departed lists" />
          </div>
        );
      };

      TimesDepartedList.defaultProps = {
        times: [],
      };

      TimesDepartedList.propTypes = {
        times: PropTypes.array,
      };

      class TimeMachine extends React.Component {
        constructor() {
          super();
          this.state = {
            dtIsOpen: false,
            destinationTime: null,
            presentTime: new Date(),
            timesDeparted: [],
          };

          this.confirmDT = this.confirmDT.bind(this);
          this.setDtIsOpen = this.setDtIsOpen.bind(this);
          this.setDateTime = this.setDateTime.bind(this);
        }

        componentDidMount() {
          console.log("Mounted TimeMachine component");
          // this.timer = setInterval(() => this.setState((prevState) => ({ presentTime: new Date() })), 1000);
        }

        componentWillUnMount() {
          console.log("Unmounted TimeMachine component");
          // clearInterval(this.timer);
        }

        setDtIsOpen() {
          this.setState(({ dtIsOpen }) => {
            const destinationTime = dtIsOpen ? null : new Date();
            return { dtIsOpen: !dtIsOpen, destinationTime };
          });
        }

        getNewTime(destinationTime, type, section) {
          const currentDT = new Date(destinationTime.getTime());
          switch (section) {
            case "month":
              const newMonth = type === "INCREMENT" ? currentDT.getMonth() + 1 : currentDT.getMonth() - 1;
              return new Date(currentDT.setMonth(newMonth));
              break;
            case "day":
              const newDay = type === "INCREMENT" ? currentDT.getDate() + 1 : currentDT.getDate() - 1;
              return new Date(currentDT.setDate(newDay));
              break;
            case "year":
              const newYear = type === "INCREMENT" ? currentDT.getFullYear() + 1 : currentDT.getFullYear() - 1;
              return new Date(currentDT.setFullYear(newYear));
              break;
            case "hour":
              const newHour = type === "INCREMENT" ? currentDT.getHours() + 1 : currentDT.getHours() - 1;
              return new Date(currentDT.setHours(newHour));
              break;
            case "min":
              const newMin = type === "INCREMENT" ? currentDT.getMinutes() + 1 : currentDT.getMinutes() - 1;
              return new Date(currentDT.setMinutes(newMin));
              break;
          }
        }

        setDateTime(type, section) {
          this.setState(({ destinationTime }) => {
            const newTime = this.getNewTime(destinationTime, type, section);
            return { destinationTime: newTime };
          });
        }

        confirmDT() {
          this.setState(
            ({ dtIsOpen, destinationTime, timesDeparted }) => {
              const newTimesDeparted = [destinationTime, ...timesDeparted];
              return {
                timesDeparted: newTimesDeparted,
                lastTimeDeparted: destinationTime,
              };
            },
            () => this.setDtIsOpen()
          );
        }

        render() {
          const { dtIsOpen, presentTime, destinationTime, timesDeparted, lastTimeDeparted } = this.state;

          return (
            <div className="time-machine">
              <DestinationTime
                isOpen={dtIsOpen}
                setDtIsOpen={this.setDtIsOpen}
                time={destinationTime}
                confirmDT={this.confirmDT}
              />
              <SetDestinationTime setDateTime={this.setDateTime} isOpen={dtIsOpen} />
              <PresentTime time={presentTime} />
              <LastTime time={lastTimeDeparted} />
              <TimesDepartedList times={timesDeparted} />
            </div>
          );
        }
      }

      ReactDOM.render(<TimeMachine />, rootNode);
    </script>
  </body>
</html>
